<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ANIWORLD</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <style>
        :root { 
            --bg: #0a0a0c; --nav: rgba(15, 15, 18, 0.9); --card: rgba(30, 30, 35, 0.6); --accent: #00b4d8; 
            --text: #f3f3f3; --sub: #a0a0a0; --border: rgba(255,255,255,0.1); --input: #000; --modal: #111;
            --blob-1: rgba(0, 180, 216, 0.15); --blob-2: rgba(123, 44, 191, 0.15);
        }
        [data-theme="light"] {
            --bg: #f8f9fa; --nav: rgba(255, 255, 255, 0.9); --card: rgba(255, 255, 255, 0.8); --accent: #0077b6; 
            --text: #1d1d1f; --sub: #666; --border: #ddd; --input: #f0f0f0; --modal: #ffffff;
            --blob-1: rgba(0, 180, 216, 0.05); --blob-2: rgba(123, 44, 191, 0.05);
        }

        body { background: var(--bg); color: var(--text); font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; margin: 0; padding-bottom: 60px; overflow-x: hidden; transition: background 0.3s; position: relative; }

        /* èƒŒæ™¯å‹•æ…‹ */
        .bg-blobs { position: fixed; inset: 0; z-index: -1; overflow: hidden; filter: blur(80px); pointer-events: none; }
        .blob { position: absolute; border-radius: 50%; animation: move 20s infinite alternate; }
        .blob-1 { width: 400px; height: 400px; background: var(--blob-1); top: -100px; left: -100px; }
        .blob-2 { width: 500px; height: 500px; background: var(--blob-2); bottom: -100px; right: -100px; animation-delay: -5s; }
        @keyframes move { from { transform: translate(0,0); } to { transform: translate(100px, 100px); } }

        /* å°èˆªæ¬„ */
        nav { background: var(--nav); backdrop-filter: blur(20px); padding: 12px 15px; display: flex; align-items: center; position: sticky; top: 0; z-index: 1000; border-bottom: 1px solid var(--border); }
        .logo { color: var(--accent); font-weight: 900; font-size: 1.8rem; margin-right: 15px; cursor: pointer; letter-spacing: -1px; }
        .nav-links { display: flex; gap: 15px; flex-grow: 1; overflow-x: auto; scrollbar-width: none; }
        .nav-links a { color: var(--sub); text-decoration: none; font-size: 1.1rem; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .nav-links a.active { color: var(--accent); }

        /* Banner å€åŸŸ */
        .page-banner { width: 100%; height: 280px; position: relative; overflow: hidden; background: #000; }
        @media (max-width: 768px) { .page-banner { height: 180px; } }
        #banner-img { width: 100%; height: 100%; object-fit: cover; opacity: 0.6; transition: object-position 0.3s; }
        .banner-controls { position: absolute; bottom: 15px; right: 15px; display: flex; gap: 8px; }
        .banner-btn { background: rgba(0,0,0,0.7); color: #fff; border: 1px solid rgba(255,255,255,0.2); padding: 6px 12px; border-radius: 6px; font-size: 0.75rem; cursor: pointer; backdrop-filter: blur(5px); }

        /* é›†æ•¸ä»‹é¢ */
        .ep-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(65px, 1fr)); gap: 15px; padding: 30px 20px; max-width: 900px; margin: auto; }
        .ep-box { background: var(--card); border: 1px solid var(--border); padding: 15px 0; text-align: center; border-radius: 12px; cursor: pointer; font-size: 1.1rem; font-weight: 800; color: var(--text); transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); backdrop-filter: blur(5px); }
        .ep-box.active { background: var(--accent); color: #fff; border: none; box-shadow: 0 0 20px rgba(0, 180, 216, 0.5); transform: scale(1.1); }

        /* é€šç”¨å…ƒä»¶æ¨£å¼ */
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        @media (min-width: 768px) { .grid { grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); } }
        .card { background: var(--card); border-radius: 18px; overflow: hidden; cursor: pointer; border: 1px solid var(--border); position: relative; backdrop-filter: blur(10px); }
        .card img { width: 100%; aspect-ratio: 3/4; object-fit: cover; }
        
        #room-modal { position: fixed; inset: 0; background: var(--bg); z-index: 10000; display: none; align-items: center; justify-content: center; padding: 20px; }
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 5000; align-items: center; justify-content: center; }
        .modal-content { background: var(--modal); width: 90%; max-width: 450px; border-radius: 24px; padding: 30px; border: 1px solid var(--border); color: var(--text); }
        input, textarea, select { width: 100%; padding: 14px; margin: 10px 0; background: var(--input); border: 1px solid var(--border); color: var(--text); border-radius: 12px; box-sizing: border-box; }
        #noti-panel { display: none; position: fixed; top: 65px; right: 15px; width: 300px; background: var(--modal); border: 1px solid var(--border); border-radius: 18px; z-index: 3000; }
    </style>
</head>
<body onclick="closeNoti()">

<div class="bg-blobs">
    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>
</div>

<div id="room-modal">
    <div class="room-card" style="background: var(--modal); border: 1px solid var(--border); padding: 40px 30px; border-radius: 24px; width: 100%; max-width: 360px; text-align: center;">
        <h2 style="color:var(--accent); margin: 0 0 10px 0;">ANIWORLD</h2>
        <p style="color:var(--sub); font-size:0.9rem; margin-bottom:30px;">é€²å…¥åŒæ­¥ç©ºé–“</p>
        <button onclick="createRoom()" style="width: 100%; padding: 15px; border-radius: 12px; border: none; font-weight: bold; background:var(--accent); color:#fff; cursor: pointer;">âœ¨ å»ºç«‹æ–°æˆ¿é–“ (è‡ªè¨‚ä»£ç¢¼)</button>
        <div style="margin:25px 0; color:var(--sub); font-size:0.8rem;">æˆ–è€…</div>
        <input type="text" id="join-input" placeholder="è¼¸å…¥æˆ¿è™Ÿ..." style="text-align:center; text-transform:uppercase;">
        <button onclick="joinRoom()" style="width:100%; padding: 15px; border-radius: 12px; border: 1px solid var(--border); font-weight: bold; background:var(--input); color:var(--text); cursor: pointer; margin-top:15px;">ğŸ”— åŠ å…¥æˆ¿é–“</button>
    </div>
</div>

<div id="main-view">
    <nav onclick="event.stopPropagation()">
        <div class="logo" onclick="showPage('home')">ANIWORLD</div>
        <div class="nav-links">
            <a id="nav-home" onclick="showPage('home')" class="active">é¦–é </a>
            <a id="nav-all" onclick="showPage('all')">å‹•ç•«åº«</a>
            <a id="nav-my" onclick="showPage('my')">æˆ‘çš„æ”¶è—</a>
            <a id="nav-history" onclick="showPage('history')">è§€çœ‹ç´€éŒ„</a>
        </div>
        <div class="nav-right" style="display:flex; align-items:center; gap:12px;">
            <div onclick="toggleNoti()" style="position:relative; cursor:pointer; font-size:1.2rem;">ğŸ””<div id="noti-dot" style="position:absolute; top:-2px; right:-2px; width:8px; height:8px; background:red; border-radius:50%; display:none;"></div></div>
            <div class="room-tag" id="room-display" onclick="copyRoom()">----</div>
            <button onclick="toggleTheme()" id="theme-icon" style="background:none; border:none; cursor:pointer; font-size:1.2rem;">ğŸŒ™</button>
            <button onclick="logout()" style="background:none; border:none; color:var(--sub); cursor:pointer; font-size:0.8rem;">ç™»å‡º</button>
        </div>
    </nav>

    <div class="page-banner">
        <img id="banner-img" src="https://images.alphacoders.com/132/1329241.jpeg">
        <div class="banner-controls">
            <button class="banner-btn" onclick="document.getElementById('banner-upload').click()">ğŸ“· ä¸Šå‚³</button>
            <button class="banner-btn" onclick="adjustBannerPos()">ğŸ“ èª¿æ•´ä½ç½®</button>
            <button class="banner-btn" style="color:#ff4d4d;" onclick="deleteBanner()">ğŸ—‘ï¸ åˆªé™¤</button>
        </div>
        <input type="file" id="banner-upload" hidden accept="image/*" onchange="uploadBanner(this)">
    </div>

    <div class="container" style="padding:20px; max-width:1400px; margin:auto;">
        <div id="display-area"></div>
    </div>
</div>

<div id="detail-view" style="display:none;">
    <button onclick="closeDetail()" style="position:fixed; top:20px; left:20px; z-index:100; background:rgba(0,0,0,0.5); border:none; color:#fff; padding:10px 25px; border-radius:30px; cursor:pointer; font-weight:bold; backdrop-filter:blur(10px);">â† è¿”å›</button>
    <div id="detail-hero-area"></div>
    <div class="detail-content" style="position: relative; margin-top: -150px; padding: 0 20px; display: flex; flex-direction: column; align-items: center;">
        <div id="detail-poster-area" style="margin-bottom: 25px;"></div>
        <div id="detail-info-area" style="background: var(--nav); backdrop-filter: blur(20px); border: 1px solid var(--border); padding: 25px; border-radius: 24px; width: 90%; max-width: 600px; text-align: center; color: var(--text);"></div>
    </div>
    <div id="ep-list-ui" class="ep-grid"></div>
    <div id="action-ui" style="display:flex; gap:20px; justify-content:center; margin-bottom:50px;"></div>
</div>

<div class="modal" id="editModal">
    <div class="modal-content">
        <h3 style="margin-top:0;">ç·¨è¼¯å‹•ç•«</h3>
        <input type="hidden" id="edit-id">
        <input type="text" id="m-title" placeholder="å‹•ç•«åç¨±">
        <input type="text" id="m-img" placeholder="å°é¢ç¶²å€">
        <select id="m-year"></select>
        <div class="tag-pool" id="tag-pool-ui" style="display:flex; flex-wrap:wrap; gap:8px; margin:10px 0;"></div>
        <textarea id="m-links" rows="5" placeholder="å½±ç‰‡é€£çµ (ä¸€è¡Œä¸€å€‹)"></textarea>
        <button onclick="saveData()" style="width:100%; background:var(--accent); border:none; padding:15px; border-radius:12px; font-weight:bold; color:#fff; cursor:pointer;">å„²å­˜è®Šæ›´</button>
        <button onclick="closeModal()" style="width:100%; background:none; border:none; color:var(--sub); margin-top:10px; cursor:pointer;">å–æ¶ˆ</button>
    </div>
</div>

<button id="add-btn" style="position:fixed; bottom:25px; right:25px; width:60px; height:60px; border-radius:50%; background:var(--accent); border:none; font-size:30px; color:#fff; cursor:pointer; z-index:900; box-shadow:0 10px 30px rgba(0, 180, 216, 0.4);" onclick="openModal()">+</button>

<div id="noti-panel" onclick="event.stopPropagation()">
    <div style="padding:15px; font-weight:bold; border-bottom:1px solid var(--border);">æœ€æ–°å‹•æ…‹</div>
    <div id="noti-list" style="max-height:300px; overflow-y:auto;"></div>
</div>

<script>
    const DEFAULT_BANNER = "https://images.alphacoders.com/132/1329241.jpeg";
    const PRESET_TAGS = ["ç†±è¡€", "å†’éšª", "æˆ€æ„›", "ç•°ä¸–ç•Œ", "æ ¡åœ’", "å¥‡å¹»", "æç¬‘", "æ²»ç™’", "æ‡¸ç–‘", "æ¨ç†", "ç§‘å¹»", "å‹•ä½œ", "æ—¥å¸¸", "ç™¾åˆ", "å‚¬æ·š", "ææ€–", "é‹å‹•", "æˆ°çˆ­", "æ©Ÿç”²", "æš—é»‘", "è‚‰ç•ª", "æˆ°é¬¥", "ç•°èƒ½", "æ³¡éºµç•ª", "åŸå‰µ", "æ”¹ç·¨", "ç¾é£Ÿ", "éŸ³æ¨‚"];
    const firebaseConfig = {
        apiKey: "AIzaSyB_LCa3ZOmcALbxw5SFjx78DzDD3mopXV4",
        authDomain: "aniworld-e53fb.firebaseapp.com",
        projectId: "aniworld-e53fb",
        databaseURL: "https://aniworld-e53fb-default-rtdb.asia-southeast1.firebasedatabase.app/",
        storageBucket: "aniworld-e53fb.firebasestorage.app",
        messagingSenderId: "436374917789",
        appId: "1:436374917789:web:11f19fe22e81763231fa74"
    };
    
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let groupKey = localStorage.getItem('ani_room_id'), animes = [], currentPage = 'home', selectedTags = [], searchQuery = "";

    function start() {
        const savedTheme = localStorage.getItem('ani_theme') || 'dark';
        document.documentElement.setAttribute('data-theme', savedTheme);
        document.getElementById('theme-icon').innerText = savedTheme === 'dark' ? 'ğŸŒ™' : 'â˜€ï¸';

        if(!groupKey) {
            document.getElementById('room-modal').style.display = 'flex';
            document.getElementById('main-view').style.display = 'none';
            document.getElementById('add-btn').style.display = 'none';
            return;
        }

        document.getElementById('room-display').innerText = groupKey;
        const savedBanner = localStorage.getItem('ani_banner_' + groupKey);
        const savedPos = localStorage.getItem('ani_banner_pos_' + groupKey) || '50%';
        document.getElementById('banner-img').src = savedBanner || DEFAULT_BANNER;
        document.getElementById('banner-img').style.objectPosition = `center ${savedPos}`;

        db.ref('rooms/'+groupKey+'/data').on('value', snap => {
            animes = snap.val() ? Object.values(snap.val()) : [];
            renderContent();
        });
        db.ref('rooms/'+groupKey+'/logs').limitToLast(15).on('value', snap => {
            const v = snap.val();
            if(v) {
                const logs = Object.values(v).reverse();
                document.getElementById('noti-list').innerHTML = logs.map(l => `<div style="padding:12px; border-bottom:1px solid var(--border); font-size:0.85rem;"><b>${l.msg || l.title}</b> ${l.ep ? 'æ›´æ–°è‡³ç¬¬ '+l.ep+' é›†' : ''}<br><small style="color:var(--sub)">${l.time}</small></div>`).join('');
                document.getElementById('noti-dot').style.display = 'block';
            }
        });
    }

    function uploadBanner(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const dataUrl = e.target.result;
                document.getElementById('banner-img').src = dataUrl;
                localStorage.setItem('ani_banner_' + groupKey, dataUrl);
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    function deleteBanner() {
        if(confirm("ç¢ºå®šæ¢å¾©é è¨­å°é¢ï¼Ÿ")) {
            localStorage.removeItem('ani_banner_' + groupKey);
            localStorage.removeItem('ani_banner_pos_' + groupKey);
            document.getElementById('banner-img').src = DEFAULT_BANNER;
            document.getElementById('banner-img').style.objectPosition = 'center 50%';
        }
    }

    function adjustBannerPos() {
        const pos = prompt("è«‹è¼¸å…¥åç§»ç™¾åˆ†æ¯” (0-100)ï¼š\n0 æ˜¯æœ€ä¸Šæ–¹ï¼Œ100 æ˜¯æœ€ä¸‹æ–¹", "50");
        if(pos !== null) {
            const validPos = `${pos}%`;
            document.getElementById('banner-img').style.objectPosition = `center ${validPos}`;
            localStorage.setItem('ani_banner_pos_' + groupKey, validPos);
        }
    }

    function toggleTheme() {
        const next = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
        document.documentElement.setAttribute('data-theme', next);
        localStorage.setItem('ani_theme', next);
        document.getElementById('theme-icon').innerText = next === 'dark' ? 'ğŸŒ™' : 'â˜€ï¸';
    }

    const ys = document.getElementById('m-year');
    for(let i=2026; i>=1990; i--) ys.innerHTML += `<option value="${i}">${i}</option>`;

    function createRoom() {
        const id = prompt("æˆ¿è™Ÿï¼š")?.toUpperCase() || Math.random().toString(36).substr(2, 6).toUpperCase();
        localStorage.setItem('ani_room_id', id); location.reload();
    }
    function joinRoom() {
        const id = document.getElementById('join-input').value.trim().toUpperCase();
        if(id) { localStorage.setItem('ani_room_id', id); location.reload(); }
    }
    function renderContent() {
        const area = document.getElementById('display-area');
        let list = [...animes];
        let title = "æœ€è¿‘æ›´æ–°";
        if(currentPage === 'my') { list = list.filter(a => a.isFav); title = "æˆ‘çš„æ”¶è—"; }
        if(currentPage === 'history') { list = list.filter(a => a.lastEp).sort((a,b) => b.lastTime - a.lastTime); title = "è§€çœ‹ç´€éŒ„"; }
        if(currentPage === 'all') title = "å®Œæ•´å‹•ç•«åº«";

        area.innerHTML = `<h2 style="margin:20px 0; border-left:6px solid var(--accent); padding-left:15px; font-size:1.4rem;">${title}</h2><div class="grid"></div>`;
        const grid = area.querySelector('.grid');
        list.forEach(a => {
            grid.innerHTML += `
                <div class="card">
                    <div style="position:absolute; top:10px; right:10px; background:rgba(0,0,0,0.6); width:35px; height:35px; border-radius:50%; display:flex; align-items:center; justify-content:center; z-index:10; backdrop-filter:blur(5px);" onclick="event.stopPropagation(); toggleFav('${a.id}', ${!a.isFav})">${a.isFav ? 'â¤ï¸' : 'ğŸ¤'}</div>
                    <div onclick="openDetail('${a.id}')">
                        <img src="${a.img || 'https://via.placeholder.com/300x400'}">
                        <div style="padding:15px;">
                            <div style="font-weight:bold; height:2.8rem; overflow:hidden; display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical; font-size:1rem;">${a.title}</div>
                            <div style="color:var(--sub); font-size:0.8rem; margin-top:5px;">${a.year} Â· ${a.tags ? a.tags[0] : 'æœªåˆ†é¡'}</div>
                        </div>
                    </div>
                </div>`;
        });
    }

    function openDetail(id) {
        const a = animes.find(i => i.id == id);
        document.getElementById('main-view').style.display = 'none';
        document.getElementById('add-btn').style.display = 'none';
        document.getElementById('detail-view').style.display = 'block';
        window.scrollTo(0,0);
        document.getElementById('detail-hero-area').innerHTML = `<div style="width:100%; height:450px; position:relative;"><img src="${a.img}" style="width:100%; height:100%; object-fit:cover; filter:brightness(0.4);"><div style="position:absolute; inset:0; background:linear-gradient(to bottom, transparent 20%, var(--bg) 100%);"></div></div>`;
        document.getElementById('detail-poster-area').innerHTML = `<img src="${a.img}" style="width:200px; aspect-ratio:3/4; border-radius:24px; box-shadow:0 30px 60px rgba(0,0,0,0.6); border:1px solid var(--border);">`;
        document.getElementById('detail-info-area').innerHTML = `<div style="font-size:2.4rem; font-weight:900; margin-bottom:10px;">${a.title}</div><div style="color:var(--accent); font-size:1.1rem; font-weight:600;">${a.year} â€¢ ${a.tags ? a.tags.join(' / ') : 'ä¸€èˆ¬'}</div>`;
        const epArea = document.getElementById('ep-list-ui');
        epArea.innerHTML = '';
        (a.links || []).forEach((l, i) => {
            epArea.innerHTML += `<div class="ep-box ${a.lastEp == i+1 ? 'active' : ''}" onclick="handleLink('${a.id}','${l}',${i+1},'${a.title.replace(/'/g, "\\'")}')">${i+1}</div>`;
        });
        document.getElementById('action-ui').innerHTML = `<button onclick="openModal('${a.id}')" style="background:var(--card); border:1px solid var(--border); color:var(--sub); padding:12px 35px; border-radius:30px; cursor:pointer; font-weight:bold;">ç·¨è¼¯è³‡æ–™</button><button onclick="deleteAni('${a.id}')" style="background:none; border:none; color:#ff4d4d; cursor:pointer; font-weight:bold;">åˆªé™¤å‹•ç•«</button>`;
    }

    function closeDetail() { document.getElementById('main-view').style.display = 'block'; document.getElementById('add-btn').style.display = 'block'; document.getElementById('detail-view').style.display = 'none'; }
    function deleteAni(id) { if(confirm("ç¢ºå®šåˆªé™¤ï¼Ÿ")) { db.ref('rooms/'+groupKey+'/data/'+id).remove(); closeDetail(); } }
    function handleLink(id, url, ep, title) {
        db.ref('rooms/'+groupKey+'/data/'+id).update({ lastEp: ep, lastTime: Date.now() });
        const now = new Date();
        const timeStr = `${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}:${now.getSeconds().toString().padStart(2,'0')}`;
        db.ref('rooms/'+groupKey+'/logs').push({ msg: "", title, ep, time: timeStr });
        window.open(url, '_blank');
    }
    function openModal(id = null) {
        document.getElementById('editModal').style.display = 'flex';
        if(id) {
            const a = animes.find(i => i.id == id);
            document.getElementById('edit-id').value = a.id;
            document.getElementById('m-title').value = a.title;
            document.getElementById('m-img').value = a.img;
            document.getElementById('m-year').value = a.year;
            document.getElementById('m-links').value = (a.links || []).join('\n');
            selectedTags = a.tags || [];
        } else {
            document.getElementById('edit-id').value = ""; document.getElementById('m-title').value = ""; document.getElementById('m-links').value = ""; selectedTags = [];
        }
        renderTags();
    }
    function renderTags() {
        document.getElementById('tag-pool-ui').innerHTML = PRESET_TAGS.map(t => `<div style="padding:6px 15px; background:${selectedTags.includes(t)?'var(--accent)':'var(--card)'}; color:${selectedTags.includes(t)?'#fff':'var(--sub)'}; border-radius:20px; font-size:0.8rem; cursor:pointer; border:1px solid var(--border);" onclick="toggleTag('${t}')">${t}</div>`).join('');
    }
    function toggleTag(t) {
        if(selectedTags.includes(t)) selectedTags = selectedTags.filter(i => i !== t); else selectedTags.push(t); renderTags();
    }
    function saveData() {
        const id = document.getElementById('edit-id').value || Date.now().toString();
        const title = document.getElementById('m-title').value;
        const isNew = !document.getElementById('edit-id').value;
        db.ref('rooms/'+groupKey+'/data/'+id).update({
            id, title, img: document.getElementById('m-img').value,
            year: document.getElementById('m-year').value,
            tags: selectedTags, links: document.getElementById('m-links').value.split('\n').filter(l => l.trim()),
            lastTime: Date.now()
        });
        const now = new Date();
        const timeStr = `${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}:${now.getSeconds().toString().padStart(2,'0')}`;
        db.ref('rooms/'+groupKey+'/logs').push({ msg: isNew ? `âœ¨ æ–°å¢äº†ï¼š${title}` : `ğŸ“ ${title} æ›´æ–°`, time: timeStr });
        closeModal();
        if(document.getElementById('detail-view').style.display === 'block') openDetail(id);
    }

    function copyRoom() { navigator.clipboard.writeText(groupKey); alert("æˆ¿è™Ÿå·²è¤‡è£½ï¼"); }
    function showPage(p) { currentPage = p; closeDetail(); document.querySelectorAll('.nav-links a').forEach(a => a.classList.remove('active')); document.getElementById('nav-'+p).classList.add('active'); renderContent(); }
    function toggleFav(id, status) { db.ref('rooms/'+groupKey+'/data/'+id).update({ isFav: status }); }
    function toggleNoti() { document.getElementById('noti-panel').style.display = (document.getElementById('noti-panel').style.display === 'block' ? 'none' : 'block'); document.getElementById('noti-dot').style.display = 'none'; }
    function closeModal() { document.getElementById('editModal').style.display = 'none'; }
    function logout() { if(confirm("ç¢ºå®šç™»å‡ºï¼Ÿ")) { localStorage.removeItem('ani_room_id'); location.reload(); } }
    function closeNoti() { document.getElementById('noti-panel').style.display = 'none'; }

    start();
</script>
</body>
</html>
